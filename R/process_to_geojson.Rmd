---
title: "process_to_geojson"
author: "Camden Blatchly"
date: "6/25/2024"
output: html_document
---


```{r}

library(dplyr)
library(tidyr)
library(sf)
library(tigris)
library(here)
library(coriverse)
library(rmapshaper)

i_am("R/process_to_geojson.Rmd")

```


```{r}

raw_dta <- st_read("acp_uptake_wide.gpkg")

```

```{r}

clean_dta <- raw_dta %>%
  select(Zipcode, Eligible, tidyr::starts_with("Subscribed_"), tidyr::starts_with("Percent"), geom) %>%
  mutate(Zipcode = as.character(Zipcode)) %>%
  sf::st_as_sf()

```

```{r}

clean_dta %>%
  filter(
    stringr::str_starts(Zipcode, "01") |
    stringr::str_starts(Zipcode, "02") |
    stringr::str_starts(Zipcode, "03") |
    stringr::str_starts(Zipcode, "04") |
    stringr::str_starts(Zipcode, "05")
  ) %>%
  ms_simplify(keep = 0.1) %>%
  st_transform(crs = "urn:ogc:def:crs:OGC:1.3:CRS84") %>%
  st_write("acp_new_england.geojson", driver = "GeoJSON")

```

```{r}

clean_dta %>%
  ms_simplify(keep = 0.05) %>%
  st_transform(crs = "urn:ogc:def:crs:OGC:1.3:CRS84") %>%
  st_write("acp_all_simplified.geojson", driver = "GeoJSON")

```
